{"version":3,"file":"multipass-utils-Btdq4M2H.js","sources":["../../src/lib/web-components/shared/multipass-utils.js"],"sourcesContent":["/**\n * MultiPass Conversion Utilities\n * \n * Converts MultiPass objects to API query parameters and endpoints.\n * Based on the logic from /routes/explore\n */\n\n/**\n * Converts MultiPass to API query parameters\n * @param {Object} multiPass - MultiPass object\n * @returns {Object} Query parameters for octo-store\n */\nexport function multipassToParams(multiPass) {\n  if (!multiPass) return {};\n  \n  return {\n    server: multiPass.meta?.server || 'https://octothorp.es',\n    s: multiPass.subjects?.include?.join(',') || '',\n    o: multiPass.objects?.include?.join(',') || '',\n    nots: multiPass.subjects?.exclude?.join(',') || '',\n    noto: multiPass.objects?.exclude?.join(',') || '',\n    match: determineMatch(multiPass),\n    limit: String(multiPass.filters?.limitResults || 10),\n    offset: String(multiPass.filters?.offsetResults || 0),\n    when: parseDateRange(multiPass.filters?.dateRange)\n  };\n}\n\n/**\n * Extracts what/by endpoint from MultiPass\n * @param {Object} multiPass - MultiPass object\n * @returns {Object} { what, by } endpoint parameters\n */\nexport function extractWhatBy(multiPass) {\n  if (!multiPass) return { what: 'pages', by: 'thorped' };\n  \n  // Determine 'what' from resultMode\n  let what = 'pages';\n  if (multiPass.meta?.resultMode === 'blobjects') {\n    what = 'everything';\n  } else if (multiPass.meta?.resultMode === 'octothorpes') {\n    what = 'thorpes';\n  } else if (multiPass.meta?.resultMode === 'links') {\n    what = 'pages';\n  }\n  \n  // Determine 'by' from object type and subtype\n  let by = 'thorped';\n  \n  if (multiPass.objects?.type === 'termsOnly') {\n    by = 'thorped';\n  } else if (multiPass.filters?.subtype === 'Backlink') {\n    by = 'backlinked';\n  } else if (multiPass.filters?.subtype === 'Cite') {\n    by = 'cited';\n  } else if (multiPass.filters?.subtype === 'Bookmark') {\n    by = 'bookmarked';\n  } else if (multiPass.subjects?.mode === 'byParent') {\n    by = 'in-webring';\n  } else if (multiPass.objects?.type === 'notTerms') {\n    by = 'linked';\n  } else if (multiPass.objects?.type === 'none') {\n    by = 'posted';\n  } else {\n    // Default to linked if objects are present\n    by = 'linked';\n  }\n  \n  return { what, by };\n}\n\n/**\n * Determines match parameter from subject/object modes\n * @param {Object} multiPass - MultiPass object\n * @returns {string} Match mode string\n */\nfunction determineMatch(multiPass) {\n  const sMode = multiPass.subjects?.mode || 'auto';\n  const oMode = multiPass.objects?.mode || 'auto';\n  \n  if (sMode === 'fuzzy' && oMode === 'auto') return 'fuzzy-s';\n  if (oMode === 'fuzzy' && sMode === 'auto') return 'fuzzy-o';\n  if (oMode === 'very-fuzzy') return 'very-fuzzy-o';\n  if (sMode === 'fuzzy' || oMode === 'fuzzy') return 'fuzzy';\n  \n  return ''; // auto/exact\n}\n\n/**\n * Converts MultiPass dateRange to 'when' parameter\n * @param {Object} dateRange - MultiPass dateRange object\n * @returns {string} When parameter string\n */\nfunction parseDateRange(dateRange) {\n  if (!dateRange) return '';\n  \n  const formatDate = (timestamp) => {\n    const date = new Date(timestamp);\n    return date.toISOString().split('T')[0];\n  };\n  \n  if (dateRange.after && dateRange.before) {\n    return `between-${formatDate(dateRange.after)}-and-${formatDate(dateRange.before)}`;\n  } else if (dateRange.after) {\n    return `after-${formatDate(dateRange.after)}`;\n  } else if (dateRange.before) {\n    return `before-${formatDate(dateRange.before)}`;\n  }\n  \n  return '';\n}\n\n/**\n * Validates if an object is a properly structured MultiPass\n * @param {*} data - Data to validate\n * @returns {boolean} True if valid MultiPass\n */\nexport function isValidMultipass(data) {\n  if (typeof data !== 'object' || data === null) return false;\n  \n  // Check required top-level properties\n  if (!data.meta || !data.subjects || !data.objects || !data.filters) {\n    return false;\n  }\n  \n  // Check meta has required fields\n  if (!data.meta.resultMode || !data.meta.version || !data.meta.server) {\n    return false;\n  }\n  \n  // Check subjects structure\n  if (!Array.isArray(data.subjects.include) || !Array.isArray(data.subjects.exclude)) {\n    return false;\n  }\n  \n  // Check objects structure\n  if (!Array.isArray(data.objects.include) || !Array.isArray(data.objects.exclude)) {\n    return false;\n  }\n  \n  // Check filters\n  if (data.filters.limitResults === undefined || data.filters.offsetResults === undefined) {\n    return false;\n  }\n  \n  return true;\n}\n\n/**\n * Parses MultiPass from various input formats\n * @param {string|Object} input - JSON string or object\n * @returns {Object|null} Parsed MultiPass or null if invalid\n */\nexport function parseMultipass(input) {\n  if (!input) return null;\n  \n  try {\n    let parsed;\n    \n    // If string, parse as JSON\n    if (typeof input === 'string') {\n      parsed = JSON.parse(input);\n    } else if (typeof input === 'object') {\n      parsed = input;\n    } else {\n      return null;\n    }\n    \n    // Validate structure\n    if (!isValidMultipass(parsed)) {\n      console.warn('Invalid MultiPass structure:', parsed);\n      return null;\n    }\n    \n    return parsed;\n  } catch (e) {\n    console.error('Failed to parse MultiPass:', e);\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}